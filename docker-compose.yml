# # version: "3.9"
# # services:
# #   app:
# #     build: .
# #     env_file:
# #       - ./.env
# #     ports:
# #       - "3000:3000"
# #     environment:
# #       NODE_ENV: production
# #       PORT: 3000
# #       MONGO_URI: mongodb+srv://haim:951753@cluster0.p7f8azh.mongodb.net/
# #       JWT_SECRET: super-secret-change-me
# #       JWT_EXPIRES_IN: 1d
# #       COOKIE_NAME: access_token
# #       COOKIE_DOMAIN: localhost
# #       CORS_ORIGIN: http://localhost:300
# #       GOOGLE_CLIENT_ID: 823917583478-02f2crrd6tu134s54enr7117oc35pts1.apps.googleusercontent.com
# #       GOOGLE_CLIENT_SECRET: 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
# #       GOOGLE_REDIRECT_URI: http://localhost:4000/api/auth/google/callback
# #       FRONTEND_SUCCESS_REDIRECT: http://localhost:5173/
# #       FRONTEND_FAILURE_REDIRECT: http://localhost:5173/login?error=google
# #     depends_on:
# #       - mongo

# #   mongo:
# #     image: mongo:6
# #     restart: unless-stopped
# #     volumes:
# #       - mongo_data:/data/db

# # volumes:
# #   mongo_data:



# version: "3.9"

# services:
#   # בונים את ה-frontend בלבד (לא מריצים)
#   frontend-build:
#     build:
#       context: ./frontend
#       dockerfile: Dockerfile
#       args:
#         # אם צריך – הזרק כאן משתני Vite
#         VITE_API_URL: "http://localhost:3000"
#     image: saas-frontend:build
#     # אין צורך להריץ קונטיינר — זה רק אימג' עם /app/dist
#     # לכן אין ports/command

#   app:
#     build:
#       context: ./server
#       dockerfile: Dockerfile
#     image: saas-app:prod
#     container_name: saas_app
#     depends_on:
#       - frontend-build
#       # - mongo  # אם אתה משתמש במונגו בקונטיינר, הוסף כאן שירות mongo
#     env_file:
#       - ./.env
#     environment:
#       NODE_ENV: production
#       PORT: 3000
#       # אם Mongo רץ בקונטיינר בשם mongo:
#       # MONGO_URI: mongodb://mongo:27017/saas_db
#       # אם Atlas:
#       # MONGO_URI: ${MONGO_URI}
#       JWT_SECRET: ${JWT_SECRET}
#       JWT_EXPIRES_IN: 1d
#       COOKIE_NAME: access_token
#       # CORS_ORIGIN רק אם ה-Frontend לא מוגש מהשרת עצמו
#       CORS_ORIGIN: http://localhost:5173
#       GOOGLE_CLIENT_ID: ${GOOGLE_CLIENT_ID}
#       GOOGLE_CLIENT_SECRET: ${GOOGLE_CLIENT_SECRET}
#       GOOGLE_REDIRECT_URI: http://localhost:3000/api/auth/google/callback
#       FRONTEND_SUCCESS_REDIRECT: http://localhost:3000/
#       FRONTEND_FAILURE_REDIRECT: http://localhost:3000/login?error=google
#     ports:
#       - "3000:3000"
#     restart: unless-stopped

#   depends_on:
#     - mongo

#   mongo:
#     image: mongo:6
#     restart: unless-stopped
#     volumes:
#       - mongo_data:/data/db

# volumes:
#   mongo_data:




version: "3.9"

services:
  # בונים את ה-frontend (אימג' בלבד; לא מריצים קונטיינר)
  frontend-build:
    build:
      context: ./frontend
      dockerfile: Dockerfile
      args:
        VITE_API_URL: "http://localhost:3000"
    image: saas-frontend:build

  app:
    build:
      context: ./server
      dockerfile: Dockerfile
    image: saas-app:prod
    container_name: saas_app
    depends_on:
      - frontend-build
      - mongo
    env_file:
      - ./.env
    environment:
      NODE_ENV: production
      PORT: 3000
      MONGO_URI: mongodb://mongo:27017/saas_db
      JWT_SECRET: ${JWT_SECRET}
      JWT_EXPIRES_IN: 1d
      COOKIE_NAME: access_token
      CORS_ORIGIN: http://localhost:3000
      GOOGLE_CLIENT_ID: ${GOOGLE_CLIENT_ID}
      GOOGLE_CLIENT_SECRET: ${GOOGLE_CLIENT_SECRET}
      GOOGLE_REDIRECT_URI: http://localhost:3000/api/auth/google/callback
      FRONTEND_SUCCESS_REDIRECT: http://localhost:3000/
      FRONTEND_FAILURE_REDIRECT: http://localhost:3000/login?error=google
    ports:
      - "3000:3000"
    restart: unless-stopped

  mongo:
    image: mongo:7
    container_name: saas_mongo
    restart: unless-stopped
    volumes:
      - mongo_data:/data/db
    # אופציונלי: לפתוח פורט מקומי ל-Compass
    ports:
      - "27017:27017"

volumes:
  mongo_data:
